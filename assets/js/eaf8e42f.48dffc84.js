"use strict";(self.webpackChunkwiki=self.webpackChunkwiki||[]).push([[0],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=o.createContext({}),s=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=s(e.components);return o.createElement(c.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,u=a(e,["components","mdxType","originalType","parentName"]),p=s(n),d=r,m=p["".concat(c,".").concat(d)]||p[d]||h[d]||i;return n?o.createElement(m,l(l({ref:t},u),{},{components:n})):o.createElement(m,l({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=d;var a={};for(var c in t)hasOwnProperty.call(t,c)&&(a[c]=t[c]);a.originalType=e,a[p]="string"==typeof e?e:r,l[1]=a;for(var s=2;s<i;s++)l[s]=n[s];return o.createElement.apply(null,l)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9393:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var o=n(7462),r=(n(7294),n(3905));const i={},l="VMChecker Infrastructure Setup Guide",a={unversionedId:"events/vmchecker-workshop/vmchecker-moodle-install",id:"events/vmchecker-workshop/vmchecker-moodle-install",title:"VMChecker Infrastructure Setup Guide",description:"Setting Up the Environment",source:"@site/docs/events/vmchecker-workshop/vmchecker-moodle-install.md",sourceDirName:"events/vmchecker-workshop",slug:"/events/vmchecker-workshop/vmchecker-moodle-install",permalink:"/docs/events/vmchecker-workshop/vmchecker-moodle-install",editUrl:"https://github.com/open-education-hub/open-education-hub-site/website/docs/events/vmchecker-workshop/vmchecker-moodle-install.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"VMChecker Guide for the Standalone UI",permalink:"/docs/events/vmchecker-workshop/vmchecker-hw-standalone-setup"},next:{title:"Introduction",permalink:"/docs/blog/intro"}},c=[{value:"Setting Up the Environment",id:"setting-up-the-environment",children:[{value:"Moodle Setup",id:"moodle-setup",children:[{value:"Starting the Infrastructure",id:"starting-the-infrastructure",children:[],level:4},{value:"Installing the Plugin",id:"installing-the-plugin",children:[{value:"Option 1: Install through Moodle UI",id:"option-1-install-through-moodle-ui",children:[],level:5},{value:"Option 2: Install Using the CLI",id:"option-2-install-using-the-cli",children:[],level:5}],level:4},{value:"Plugin Configuration",id:"plugin-configuration",children:[],level:4}],level:3}],level:2}],s={toc:c},u="wrapper";function p(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,o.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"vmchecker-infrastructure-setup-guide"},"VMChecker Infrastructure Setup Guide"),(0,r.kt)("h2",{id:"setting-up-the-environment"},"Setting Up the Environment"),(0,r.kt)("p",null,"There are two types of setups for VMChecker, the first one is concentrated onusing Moodle as a frontend for homework checking.\nThe second one uses our own VMChecker UI to store homework results and parse requests that will be sent to the VMChecker backend."),(0,r.kt)("h3",{id:"moodle-setup"},"Moodle Setup"),(0,r.kt)("p",null,"The Moodle setup needs the following components:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"a Moodle instance where the homework are uploaded"),(0,r.kt)("li",{parentName:"ul"},"the VMChecker block plugin that will get attached to an assignment"),(0,r.kt)("li",{parentName:"ul"},"a GitLab instance that will receive the homework and start a pipeline based on it"),(0,r.kt)("li",{parentName:"ul"},"a GitLab runner accessible from the GitLab instance that is registered to a group or for the whole GitLab instance")),(0,r.kt)("p",null,"To have a baseline for the Moodle setup, we will be using the ",(0,r.kt)("a",{parentName:"p",href:"https://gitlab.cs.pub.ro/vmchecker/container-templates"},"container templates")," git repository."),(0,r.kt)("h4",{id:"starting-the-infrastructure"},"Starting the Infrastructure"),(0,r.kt)("p",null,"From here, we are able to study the ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," file provided in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Moodle")," directory contains the necessary components to set a Moodle instance together with the VMChecker backend, and a GitLab Runner."),(0,r.kt)("p",null,"To start up the infrastructure, you will have to run the following command in the ",(0,r.kt)("inlineCode",{parentName:"p"},"container-templates/moodle")," directory:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker-compose -f ./docker-compose.yml --env-file ./.env -p vmchecker-test up\n")),(0,r.kt)("p",null,"The Moodle instance will have started when the ",(0,r.kt)("inlineCode",{parentName:"p"},"** Starting Apache **")," message displayed on your screen."),(0,r.kt)("p",null,"To connect to the Docker-based Moodle you will have to open Firefox and connect to the ",(0,r.kt)("inlineCode",{parentName:"p"},"localhost")," address. To log in use the ",(0,r.kt)("inlineCode",{parentName:"p"},"user/bitnami")," user and password."),(0,r.kt)("p",null,"Once connected we need to import the VMChecker block plugin."),(0,r.kt)("h4",{id:"installing-the-plugin"},"Installing the Plugin"),(0,r.kt)("p",null,"VMChecker Next is a block-type plugin for Moodle, as such the installation directory of this plugin is ",(0,r.kt)("inlineCode",{parentName:"p"},"<moodle_root>/blocks/"),".\nThe name of the plugin from Moodle's perspective is ",(0,r.kt)("inlineCode",{parentName:"p"},"vmchecker"),"\xa0and the sources of this plugin must reside in ",(0,r.kt)("inlineCode",{parentName:"p"},"<moodle_root>/blocks/vmchecker"),"."),(0,r.kt)("p",null,"Currently, the plugin can only be downloaded from GitHub, with the prospect of adding it to the Moodle plugin repository."),(0,r.kt)("p",null,"The source code for the plugin can be found at ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/open-education-hub/vmchecker-next"},"vmchecker-next"),".\nSimply download the archive with the source code (go to Code -> Download ZIP)."),(0,r.kt)("h5",{id:"option-1-install-through-moodle-ui"},"Option 1: Install through Moodle UI"),(0,r.kt)("p",null,"As an Admin user go to ",(0,r.kt)("inlineCode",{parentName:"p"},"Site Administration > Plugins > Install plugins"),".\nUpload the archive with the source files and press ",(0,r.kt)("inlineCode",{parentName:"p"},"Install plugin from the ZIP file"),".\nA summary page will be presented, which on successful validation of the archive will allow you to install the plugin. Simply click continue and then follow the steps described in the Plugin configuration section."),(0,r.kt)("h5",{id:"option-2-install-using-the-cli"},"Option 2: Install Using the CLI"),(0,r.kt)("p",null,"Simply extract the archive in a temp folder and rename the extracted folder to ",(0,r.kt)("inlineCode",{parentName:"p"},"vmchecker"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"unzip vmchecker-next.zip /tmp\nmv /tmp/vmchecker-next /tmp/vmchecker\n")),(0,r.kt)("p",null,"Now, move the source folder to the Moodle installation directory inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"blocks")," subfolder."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'mv /tmp/vmchecker "${moodle_root_folder}/blocks\n')),(0,r.kt)("h4",{id:"plugin-configuration"},"Plugin Configuration"),(0,r.kt)("p",null,"After the plugin sources are added, on the next login of the admin user, a prompt, asking if you want to install the new plugin, will appear.\nNext, you will be asked to upgrade the database, and the Admin user will be asked to configure the newly installed ",(0,r.kt)("strong",{parentName:"p"},"vmchecker")," plugin."),(0,r.kt)("p",null,"Currently, there are 2 configurations that must be setup:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"vmck backend")," - The backend URL, to which requests for checking submissions are made.\nCurrently, it should be set to ",(0,r.kt)("inlineCode",{parentName:"li"},"http://backend:8000/api/v1/")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Submissions check count")," - It indicates how many submissions should be checked on each cron call.\nThis is to make sure that the checking of submissions does not take longer than a minute (the usual cron interval).\nThe default value is ",(0,r.kt)("inlineCode",{parentName:"li"},"50"),", but it can be lowered if there are valid concerns of the plugin acaparating the entire cron job (it is left to the discretion of the admin).")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"NOTE"),": Because we are running in a testing environment, and Moodle is set up for security hardening, we have to allow Moodle to connect to the backend server in an unsecured manner.\nTo do this we have to access ",(0,r.kt)("inlineCode",{parentName:"p"},"Site administration > General > HTTP security")," and delete the 172.16.0.0/12 line from ",(0,r.kt)("inlineCode",{parentName:"p"},"cURL blocked host list")," and we have to add port 8000 to the ",(0,r.kt)("inlineCode",{parentName:"p"},"cURL allower port list"),"."),(0,r.kt)("p",null,"You can continue with setting up an ",(0,r.kt)("a",{parentName:"p",href:"./vmchecker-hw-moodle-setup"},"assignment with VMChecker"),"."))}p.isMDXComponent=!0}}]);